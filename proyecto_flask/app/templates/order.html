{% extends "base.html" %}
{% block title %} My order {% endblock %}
{% block head %}
    {{ super() }}
{% endblock %}
{% block content %}
    {% include 'header.html' %}
    <div class="container">
        <section class="main">
            <div class="row">
                <div class="col-8">
                    <h3>My Order</h3>
                </div>
            </div>
            <br><br>
            {% if info.order_items %}
                <table class="table table-striped">
                    <tr>
                        <th width="200">Product</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th width="50"></th>
                    </tr>

                    {% for (order_item,product, stock) in info.order_items %}

                        {% if order_item.order_item_status_code == 1%}
                            <tr>
                                <td>
                                    <b class="name_product">{{product.name}}</b>
                                    <figure class="product_image_sm"><img src="{{ product.image }}"></figure>
                                </td>
                                <td class="align-middle">
                                    <div class="btn-group" role="group" aria-label="add_substract_products">
                                      <a href="{{ url_for('order.substract_product_to_order_active', product_id=product.id)}}" class="btn btn-success modify_order">-</a>
                                       <span class="number_of_items">{{order_item.order_item_quantity}}</span>
                                      <a {% if order_item.order_item_quantity < stock.quantity %}  href="{{ url_for('order.add_product_to_order_active', product_id=product.id)}}" {% else %} href="#" {% endif %}
                                         class="btn {% if order_item.order_item_quantity < stock.quantity %} btn-success modify_order {% else %} btn-secondary {% endif %}">+</a>
                                    </div>
                                </td>
                                <td class="align-middle">
                                    ${{ '{0:,}'.format(order_item.order_item_price| int) }}
                                </td>
                                <td class="align-middle">
                                    <a href="{{ url_for('order.remove_product_from_order_active', product_id=product.id)}}" class="delete"><i class="fas fa-trash"></i></a>
                                </td>
                            </tr>
                        {% endif %}
                    {% endfor %}
                    <tr>
                        <th colspan="3" class="text-right" >Subtotal</th>
                        <td>${{ '{0:,}'.format(info.subtotal| int) }}</td>
                    </tr>
                    <tr>
                        <th colspan="3" class="text-right" >Iva</th>
                        <td>${{ '{0:,}'.format(info.tax| int) }}</td>
                    </tr>
                    <tr>
                        <th colspan="3" class="text-right" >Total</th>
                        <td>${{ '{0:,}'.format(info.total| int) }}</td>
                    </tr>

                </table>
                <br>
                <h2>Checkout</h2>
                <br>

                <form method="POST" action="{{ url_for('order.add_invoice') }}" class="formGen" autocomplete="off">
                    {{ form.csrf_token }}
                    <div class="notification is-danger d-none">
                    </div>
                    <div class="form-group">
                        {{ form.payment_method.label }}
                        {{ form.payment_method(class_="form-control") }}
                    </div>
                    <div class="form-group">
                        {{ form.address.label }}
                        {{ form.address(class_="form-control") }}
                    </div>
                    <br>
                    <div class="text-center"><input type="submit" class="btn btn-generic " value="Payment gateway" /></div>

                </form>

            {% else %}
                <span class="no_products">You have no products in your order</span>
            {% endif%}


            <br><br><br>

        </section>
    </div>
{% endblock %}
{% block scripts %}
<script src="{{ url_for('static', filename='js/general.js')}}"></script>
{% endblock %}
